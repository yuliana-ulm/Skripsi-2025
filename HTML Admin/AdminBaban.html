<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Input Kamus Banjar</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #fef9ef; padding: 20px; }
    .form-section { background-color: #e6ffe6; border: 2px solid #c0c000; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
    .form-section h5 { color: #228B22; }
    .btn-gold { background-color: gold; color: black; }
  </style>
</head>
<body>

<div class="container">
  <h2 class="mb-4 text-center text-success">Input Data Kamus Banjar â†” Indonesia</h2>

  <form id="formKamus">

    <div class="form-section">
      <h5>ğŸ” Arah Terjemahan</h5>
      <select id="arah" class="form-select" required>
        <option value="kamus_bi_bj">Indonesia âœ Banjar</option>
        <option value="kamus_bj_bi">Banjar âœ Indonesia</option>
      </select>
    </div>

    <div class="form-section">
      <h5>ğŸ“Œ Kata Utama</h5>
      <div class="mb-3"><label class="form-label">Kata</label><input type="text" class="form-control" id="kata" required></div>
      <div class="mb-3"><label class="form-label">Suku Kata</label><input type="text" class="form-control" id="sukukata"></div>
      <div class="mb-3"><label class="form-label">Gambar (URL)</label><input type="text" class="form-control" id="gambar"></div>
    </div>

    <div class="form-section">
      <h5>ğŸ“– Definisi Umum</h5>
      <div id="definisiContainer"></div>
      <button type="button" class="btn btn-success mt-2" onclick="tambahDefinisi()">+ Tambah Definisi</button>
    </div>

    <div class="form-section">
      <h5>ğŸŒ¿ Turunan Kata</h5>
      <div id="turunanContainer"></div>
      <button type="button" class="btn btn-success mt-2" onclick="tambahTurunan()">+ Tambah Turunan</button>
    </div>

    <button type="submit" class="btn btn-gold">ğŸ’¾ Simpan ke Firebase</button>
    <div id="status" class="mt-3 text-center fw-bold"></div>
  </form>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Konfigurasi Firebase milikmu
  const firebaseConfig = {
    apiKey: "AIzaSyBvYn9DnN1jUrVHJqoEYUWwBKce3sksUyc",
    authDomain: "kamusbahasabanjar1.firebaseapp.com",
    databaseURL: "https://kamusbahasabanjar1-default-rtdb.firebaseio.com",
    projectId: "kamusbahasabanjar1",
    storageBucket: "kamusbahasabanjar1.appspot.com",
    messagingSenderId: "647625175893",
    appId: "1:647625175893:web:bc56088338616b639275dc",
    measurementId: "G-83T15Y31GN"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const definisiContainer = document.getElementById("definisiContainer");
  const turunanContainer = document.getElementById("turunanContainer");
  const statusDiv = document.getElementById("status");

  function tambahDefinisi() {
    const i = definisiContainer.children.length;
    const div = document.createElement("div");
    div.classList.add("border", "p-3", "mb-3", "bg-light");
    div.innerHTML = `
      <h6>Definisi #${i + 1}</h6>
      <div class="mb-2"><input type="text" class="form-control" name="definisi_${i}" placeholder="Definisi" required></div>
      <div class="mb-2"><input type="text" class="form-control" name="kelaskata_${i}" placeholder="Kelas Kata"></div>
      <div class="mb-2"><input type="text" class="form-control" name="suara_${i}" placeholder="Suara"></div>
      <div class="mb-2"><input type="text" class="form-control" name="contoh_banjar_${i}" placeholder="Contoh Banjar"></div>
      <div class="mb-2"><input type="text" class="form-control" name="contoh_indonesia_${i}" placeholder="Contoh Indonesia"></div>
    `;
    definisiContainer.appendChild(div);
  }

  function tambahTurunan() {
    const i = turunanContainer.children.length;
    const div = document.createElement("div");
    div.classList.add("border", "p-3", "mb-3", "bg-light");
    div.innerHTML = `
      <h6>Turunan #${i + 1}</h6>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_kata_${i}" placeholder="Kata Turunan" required></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_sukukata_${i}" placeholder="Suku Kata"></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_gambar_${i}" placeholder="Gambar URL"></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_definisi_${i}" placeholder="Definisi" required></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_kelaskata_${i}" placeholder="Kelas Kata"></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_suara_${i}" placeholder="Suara"></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_contoh_banjar_${i}" placeholder="Contoh Banjar"></div>
      <div class="mb-2"><input type="text" class="form-control" name="turunan_contoh_indonesia_${i}" placeholder="Contoh Indonesia"></div>
    `;
    turunanContainer.appendChild(div);
  }

  document.getElementById("formKamus").addEventListener("submit", async function(e) {
    e.preventDefault();
    statusDiv.textContent = "Menyimpan...";

    try {
      const definisiList = [];
      for(let i=0; i<definisiContainer.children.length; i++){
        definisiList.push({
          definisi: this[`definisi_${i}`].value,
          kelaskata: this[`kelaskata_${i}`].value,
          suara: this[`suara_${i}`].value,
          contoh: [{
            banjar: this[`contoh_banjar_${i}`].value,
            indonesia: this[`contoh_indonesia_${i}`].value,
          }]
        });
      }

      const turunanList = [];
      for(let i=0; i<turunanContainer.children.length; i++){
        turunanList.push({
          kata: this[`turunan_kata_${i}`].value,
          sukukata: this[`turunan_sukukata_${i}`].value,
          gambar: this[`turunan_gambar_${i}`].value,
          definisi_umum: [{
            definisi: this[`turunan_definisi_${i}`].value,
            kelaskata: this[`turunan_kelaskata_${i}`].value,
            suara: this[`turunan_suara_${i}`].value,
            contoh: [{
              banjar: this[`turunan_contoh_banjar_${i}`].value,
              indonesia: this[`turunan_contoh_indonesia_${i}`].value
            }]
          }]
        });
      }

      const kataUtama = this.kata.value.trim().toLowerCase();
      const arah = document.getElementById("arah").value;

      const data = {
        kata: kataUtama,
        sukukata: this.sukukata.value,
        gambar: this.gambar.value,
        definisi_umum: definisiList,
        turunan: turunanList
      };

      // Menyimpan dokumen dengan ID berdasarkan kata
      await db.collection(arah).doc(kataUtama).set(data);

      statusDiv.textContent = "âœ… Data berhasil disimpan!";
      this.reset();
      definisiContainer.innerHTML = "";
      turunanContainer.innerHTML = "";
      tambahDefinisi();
      tambahTurunan();
    } catch (error) {
      statusDiv.textContent = "âŒ Gagal menyimpan: " + error.message;
    }
  });

  tambahDefinisi();
  tambahTurunan();
</script>

</body>
</html>
